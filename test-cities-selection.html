<!DOCTYPE html>
<html>
<head>
    <title>Test Cities Selection</title>
</head>
<body>
    <h1>Test de sélection des villes</h1>
    
    <form id="test-form" method="POST" action="/test-cities">
        <div id="cities-container">
            <label>
                <input type="checkbox" class="city-checkbox" value="1"> Ville 1
            </label><br>
            <label>
                <input type="checkbox" class="city-checkbox" value="2"> Ville 2
            </label><br>
            <label>
                <input type="checkbox" class="city-checkbox" value="3"> Ville 3
            </label><br>
        </div>
        
        <button type="submit">Tester la soumission</button>
    </form>
    
    <div id="debug"></div>
    
    <script>
    let selectedCities = [];
    
    function updateSelectedCities() {
        const checkboxes = document.querySelectorAll('.city-checkbox:checked');
        selectedCities = Array.from(checkboxes).map(cb => cb.value);
        
        // Créer des inputs cachés pour chaque ville sélectionnée
        document.querySelectorAll('input[name="cities[]"]').forEach(input => input.remove());
        
        selectedCities.forEach(cityId => {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'cities[]';
            input.value = cityId;
            document.getElementById('test-form').appendChild(input);
        });
        
        // Debug
        document.getElementById('debug').innerHTML = `
            <p>Villes sélectionnées: ${selectedCities.join(', ')}</p>
            <p>Inputs cachés: ${document.querySelectorAll('input[name="cities[]"]').length}</p>
        `;
    }
    
    // Event listeners
    document.querySelectorAll('.city-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', updateSelectedCities);
    });
    
    // Test de soumission
    document.getElementById('test-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        updateSelectedCities();
        
        const hiddenInputs = document.querySelectorAll('input[name="cities[]"]');
        alert(`Villes sélectionnées: ${selectedCities.length}\nInputs cachés: ${hiddenInputs.length}\nValeurs: ${Array.from(hiddenInputs).map(i => i.value).join(', ')}`);
    });
    </script>
</body>
</html>
